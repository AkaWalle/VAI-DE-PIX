# Postgres para testes locais (Linux). Mesmas credenciais do CI.
# Sem volumes: banco sempre limpo a cada "up".
#
# Uso:
#   docker compose -f docker-compose.test.yml up -d
#   export DATABASE_URL=postgresql://vai_de_pix_user:vai_de_pix_pass@localhost:5433/vai_de_pix
#   cd backend && alembic upgrade head && pytest tests/ --ignore=tests/e2e -x

services:
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: vai_de_pix
      POSTGRES_USER: vai_de_pix_user
      POSTGRES_PASSWORD: vai_de_pix_pass
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U vai_de_pix_user -d vai_de_pix"]
      interval: 5s
      timeout: 5s
      retries: 5
